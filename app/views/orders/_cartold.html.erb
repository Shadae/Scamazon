<h2>Your Cart</h2>
<br>
<% @order.errors.full_messages.each do |error| %>
  <%= error %><br>
<% end %>



<table class="cart">
  <thead>
   <tr>
    <th>In your cart:</th>
    <th>Price:</th>
    <th>Quantity</th>
   </tr>
  </thead>

  <tbody>

2
  <tbody>
  <% @order.products.each do |product| %>
    <tr><td><%= image_tag(product.image_url, width: 30, height: 30) if product.image.present? %>
            <%= link_to product.name, product %></td>
        <td><% @order_item = OrderItem.where(product_id: product.id, order_id: @order.id)[0] %>
            <%= form_tag('/orders/add_one_product') do %>
              <%= hidden_field_tag :order_id, @order.id%>
              <%= hidden_field_tag :product_id, product.id %>
              <%= submit_tag '+' %>
           <% end %>
          <%= @order_item.quantity %>
          <% if @order_item.quantity == 1 %>
            <%= form_tag('/orders/remove_product') do %>
              <%= hidden_field_tag :order_id, @order.id%>
              <%= hidden_field_tag :product_id, product.id %>
              <%= submit_tag '-', data: { confirm: 'This will remove the product from the order! Are you sure that you want to do that?'} %>
            <% end %>
          <% else %>
            <%= form_tag('/orders/subtract_one_product') do %>
              <%= hidden_field_tag :order_id, @order.id%>
              <%= hidden_field_tag :product_id, product.id %>
              <%= submit_tag '-', data: { confirm: 'Are you sure?'} %>
            <% end %>
          <% end %>
        <td><%= price_format(product.price) %></td>
        <% subtotal += product.price * @order_item.quantity %>
        <td><%= price_format(subtotal) %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<div id="loading">
  <p><img src="ajax-loader.gif"/> Please Wait</p>
</div>

